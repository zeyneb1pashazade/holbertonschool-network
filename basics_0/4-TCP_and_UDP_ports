#!/usr/bin/env bash
# File: 4-TCP_and_UDP_ports
# Description: Displays listening TCP, UDP, and UNIX sockets, along with
#              the PID and program name associated with each socket, using netstat.

# Check if netstat is installed and exit if not
if ! command -v netstat &> /dev/null
then
    echo "Error: 'netstat' command not found. Please install the 'net-tools' package."
    exit 1
fi

# Clear the screen (optional, for clean output)
# The [exec_bash] output seems to include this, so it's kept for consistency
clear

# --- 1. Active Internet connections (TCP and UDP listening sockets) ---
echo "Active Internet connections (only servers)"
# -l: listening
# -p: process info (PID/Program name)
# -t: TCP sockets
# -u: UDP sockets
# netstat -lptuw | grep -v 'Local Address' is a good start, but we can simplify

# netstat -lp shows the TCP and UDP information in the required format
# We filter out the header lines with 'grep -v Proto'
netstat -lptuw 2>/dev/null | grep -v 'Proto'

# --- 2. Active UNIX domain sockets (listening sockets) ---
echo ""
echo "Active UNIX domain sockets (only servers)"
# -l: listening
# -p: process info (PID/Program name)
# -a: all states (needed to capture the full UNIX socket table)
# -x: UNIX domain sockets
# We use 'grep -E' to keep only the listening sockets (State: LISTENING or Flags: [ ACC ])
netstat -lpax 2>/dev/null | grep -E 'LISTENING|\[ ACC \]' | grep -v 'Proto'
